{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.responseInterceptor = void 0;\nconst zlib = require(\"zlib\");\n/**\n * Intercept responses from upstream.\n * Automatically decompress (deflate, gzip, brotli).\n * Give developer the opportunity to modify intercepted Buffer and http.ServerResponse\n *\n * NOTE: must set options.selfHandleResponse=true (prevent automatic call of res.end())\n */\nfunction responseInterceptor(interceptor) {\n  return async function proxyRes(proxyRes, req, res) {\n    const originalProxyRes = proxyRes;\n    let buffer = Buffer.from('', 'utf8');\n    // decompress proxy response\n    const _proxyRes = decompress(proxyRes, proxyRes.headers['content-encoding']);\n    // concat data stream\n    _proxyRes.on('data', chunk => buffer = Buffer.concat([buffer, chunk]));\n    _proxyRes.on('end', async () => {\n      // copy original headers\n      copyHeaders(proxyRes, res);\n      // call interceptor with intercepted response (buffer)\n      const interceptedBuffer = Buffer.from(await interceptor(buffer, originalProxyRes, req, res));\n      // set correct content-length (with double byte character support)\n      res.setHeader('content-length', Buffer.byteLength(interceptedBuffer, 'utf8'));\n      res.write(interceptedBuffer);\n      res.end();\n    });\n    _proxyRes.on('error', error => {\n      res.end(`Error fetching proxied request: ${error.message}`);\n    });\n  };\n}\nexports.responseInterceptor = responseInterceptor;\n/**\n * Streaming decompression of proxy response\n * source: https://github.com/apache/superset/blob/9773aba522e957ed9423045ca153219638a85d2f/superset-frontend/webpack.proxy-config.js#L116\n */\nfunction decompress(proxyRes, contentEncoding) {\n  let _proxyRes = proxyRes;\n  let decompress;\n  switch (contentEncoding) {\n    case 'gzip':\n      decompress = zlib.createGunzip();\n      break;\n    case 'br':\n      decompress = zlib.createBrotliDecompress();\n      break;\n    case 'deflate':\n      decompress = zlib.createInflate();\n      break;\n    default:\n      break;\n  }\n  if (decompress) {\n    _proxyRes.pipe(decompress);\n    _proxyRes = decompress;\n  }\n  return _proxyRes;\n}\n/**\n * Copy original headers\n * https://github.com/apache/superset/blob/9773aba522e957ed9423045ca153219638a85d2f/superset-frontend/webpack.proxy-config.js#L78\n */\nfunction copyHeaders(originalResponse, response) {\n  response.statusCode = originalResponse.statusCode;\n  response.statusMessage = originalResponse.statusMessage;\n  if (response.setHeader) {\n    let keys = Object.keys(originalResponse.headers);\n    // ignore chunked, brotli, gzip, deflate headers\n    keys = keys.filter(key => !['content-encoding', 'transfer-encoding'].includes(key));\n    keys.forEach(key => {\n      let value = originalResponse.headers[key];\n      if (key === 'set-cookie') {\n        // remove cookie domain\n        value = Array.isArray(value) ? value : [value];\n        value = value.map(x => x.replace(/Domain=[^;]+?/i, ''));\n      }\n      response.setHeader(key, value);\n    });\n  } else {\n    response.headers = originalResponse.headers;\n  }\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","responseInterceptor","zlib","require","interceptor","proxyRes","req","res","originalProxyRes","buffer","Buffer","from","_proxyRes","decompress","headers","on","chunk","concat","copyHeaders","interceptedBuffer","setHeader","byteLength","write","end","error","message","contentEncoding","createGunzip","createBrotliDecompress","createInflate","pipe","originalResponse","response","statusCode","statusMessage","keys","filter","key","includes","forEach","Array","isArray","map","x","replace"],"sources":["C:/Users/user/Desktop/git/toy/src/main/frontend/node_modules/http-proxy-middleware/dist/handlers/response-interceptor.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.responseInterceptor = void 0;\nconst zlib = require(\"zlib\");\n/**\n * Intercept responses from upstream.\n * Automatically decompress (deflate, gzip, brotli).\n * Give developer the opportunity to modify intercepted Buffer and http.ServerResponse\n *\n * NOTE: must set options.selfHandleResponse=true (prevent automatic call of res.end())\n */\nfunction responseInterceptor(interceptor) {\n    return async function proxyRes(proxyRes, req, res) {\n        const originalProxyRes = proxyRes;\n        let buffer = Buffer.from('', 'utf8');\n        // decompress proxy response\n        const _proxyRes = decompress(proxyRes, proxyRes.headers['content-encoding']);\n        // concat data stream\n        _proxyRes.on('data', (chunk) => (buffer = Buffer.concat([buffer, chunk])));\n        _proxyRes.on('end', async () => {\n            // copy original headers\n            copyHeaders(proxyRes, res);\n            // call interceptor with intercepted response (buffer)\n            const interceptedBuffer = Buffer.from(await interceptor(buffer, originalProxyRes, req, res));\n            // set correct content-length (with double byte character support)\n            res.setHeader('content-length', Buffer.byteLength(interceptedBuffer, 'utf8'));\n            res.write(interceptedBuffer);\n            res.end();\n        });\n        _proxyRes.on('error', (error) => {\n            res.end(`Error fetching proxied request: ${error.message}`);\n        });\n    };\n}\nexports.responseInterceptor = responseInterceptor;\n/**\n * Streaming decompression of proxy response\n * source: https://github.com/apache/superset/blob/9773aba522e957ed9423045ca153219638a85d2f/superset-frontend/webpack.proxy-config.js#L116\n */\nfunction decompress(proxyRes, contentEncoding) {\n    let _proxyRes = proxyRes;\n    let decompress;\n    switch (contentEncoding) {\n        case 'gzip':\n            decompress = zlib.createGunzip();\n            break;\n        case 'br':\n            decompress = zlib.createBrotliDecompress();\n            break;\n        case 'deflate':\n            decompress = zlib.createInflate();\n            break;\n        default:\n            break;\n    }\n    if (decompress) {\n        _proxyRes.pipe(decompress);\n        _proxyRes = decompress;\n    }\n    return _proxyRes;\n}\n/**\n * Copy original headers\n * https://github.com/apache/superset/blob/9773aba522e957ed9423045ca153219638a85d2f/superset-frontend/webpack.proxy-config.js#L78\n */\nfunction copyHeaders(originalResponse, response) {\n    response.statusCode = originalResponse.statusCode;\n    response.statusMessage = originalResponse.statusMessage;\n    if (response.setHeader) {\n        let keys = Object.keys(originalResponse.headers);\n        // ignore chunked, brotli, gzip, deflate headers\n        keys = keys.filter((key) => !['content-encoding', 'transfer-encoding'].includes(key));\n        keys.forEach((key) => {\n            let value = originalResponse.headers[key];\n            if (key === 'set-cookie') {\n                // remove cookie domain\n                value = Array.isArray(value) ? value : [value];\n                value = value.map((x) => x.replace(/Domain=[^;]+?/i, ''));\n            }\n            response.setHeader(key, value);\n        });\n    }\n    else {\n        response.headers = originalResponse.headers;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}